# Unity URP è½®å»“çº¿ç³»ç»Ÿ

## æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªé«˜åº¦å…¼å®¹çš„Unity Universal Render Pipeline (URP)è½®å»“çº¿æ¸²æŸ“ç³»ç»Ÿï¼Œæ”¯æŒä»Unity 2022.3åˆ°Unity 6.0+çš„æ‰€æœ‰ç‰ˆæœ¬ã€‚ç³»ç»Ÿé‡‡ç”¨Sobelè¾¹ç¼˜æ£€æµ‹ç®—æ³•ç”Ÿæˆé«˜è´¨é‡çš„2Dç‰©ä½“è½®å»“çº¿æ•ˆæœã€‚

## ğŸš€ æœ€æ–°ç‰¹æ€§

### å¤šç‰ˆæœ¬å…¼å®¹æ€§ä¼˜åŒ–
- âœ… **Unity 2022.3 - 2023.x**: ä½¿ç”¨ä¼ ç»Ÿçš„Executeæ¨¡å¼æ¸²æŸ“
- âœ… **Unity 6.0+**: ä½¿ç”¨æ–°çš„RenderGraphç³»ç»Ÿ
- âœ… **è‡ªåŠ¨ç‰ˆæœ¬æ£€æµ‹**: ç¼–è¯‘æ—¶è‡ªåŠ¨é€‰æ‹©é€‚é…çš„æ¸²æŸ“è·¯å¾„

### å…¼å®¹æ€§ç‰¹ç‚¹
- **å‘å‰å…¼å®¹**: æ—§é¡¹ç›®å‡çº§åˆ°Unity 6.0+æ—¶æ— éœ€ä¿®æ”¹ä»£ç 
- **å‘åå…¼å®¹**: æ–°é¡¹ç›®å¯åœ¨æ—§ç‰ˆUnityä¸­æ­£å¸¸è¿è¡Œ
- **æ€§èƒ½ä¼˜åŒ–**: åœ¨Unity 6.0+ä¸­äº«å—RenderGraphçš„æ€§èƒ½ä¼˜åŠ¿

## ğŸ“ ç³»ç»Ÿæ¶æ„

```
è½®å»“çº¿ç³»ç»Ÿ
â”œâ”€â”€ OutlineRendererFeature.cs     # ä¸»è¦æ¸²æŸ“åŠŸèƒ½ (æ”¯æŒå¤šç‰ˆæœ¬)
â”œâ”€â”€ OutlineFeature.shader         # è½®å»“çº¿ç€è‰²å™¨
â”œâ”€â”€ Renderer2D.asset             # 2Dæ¸²æŸ“å™¨é…ç½®
â””â”€â”€ UniversalRenderPipelineGlobalSettings.asset  # å…¨å±€è®¾ç½®
```

## ğŸ”§ æŠ€æœ¯å®ç°

### ç‰ˆæœ¬æ£€æµ‹æœºåˆ¶

```csharp
#if UNITY_6000_0_OR_NEWER
using UnityEngine.Rendering.RenderGraphModule;
#endif
```

ç³»ç»Ÿä½¿ç”¨é¢„å¤„ç†æŒ‡ä»¤è‡ªåŠ¨æ£€æµ‹Unityç‰ˆæœ¬ï¼Œç¡®ä¿ä»£ç åœ¨ä¸åŒç‰ˆæœ¬ä¸­çš„æ­£ç¡®æ‰§è¡Œã€‚

### åŒæ¸²æŸ“è·¯å¾„

#### ä¼ ç»Ÿæ¨¡å¼ (Unity 2022.3 - 2023.x)
```csharp
#if !UNITY_6000_0_OR_NEWER
public override void Execute(ScriptableRenderContext context, ref RenderingData renderingData)
{
    // ä¼ ç»ŸExecuteæ–¹æ³•å®ç°
    // æ‰‹åŠ¨ç®¡ç†RTçº¹ç†ç”Ÿå‘½å‘¨æœŸ
}
#endif
```

**ç‰¹ç‚¹:**
- ä½¿ç”¨`Execute`æ–¹æ³•è¿›è¡Œæ¸²æŸ“
- æ‰‹åŠ¨ç®¡ç†`RTHandle`èµ„æº
- å…¼å®¹æ‰€æœ‰æ—§ç‰ˆUnityé¡¹ç›®

#### RenderGraphæ¨¡å¼ (Unity 6.0+)
```csharp
#if UNITY_6000_0_OR_NEWER
public override void RecordRenderGraph(RenderGraph renderGraph, ContextContainer frameData)
{
    // RenderGraphå®ç°
    // è‡ªåŠ¨èµ„æºç®¡ç†å’Œä¼˜åŒ–
}
#endif
```

**ç‰¹ç‚¹:**
- ä½¿ç”¨`RecordRenderGraph`æ–¹æ³•
- è‡ªåŠ¨çº¹ç†ç”Ÿå‘½å‘¨æœŸç®¡ç†
- æ›´å¥½çš„æ€§èƒ½å’Œå†…å­˜ä¼˜åŒ–
- GPUè°ƒè¯•æ”¯æŒå¢å¼º

### æ ¸å¿ƒæ¸²æŸ“æµç¨‹

æ— è®ºå“ªä¸ªç‰ˆæœ¬ï¼Œéƒ½é‡‡ç”¨ç›¸åŒçš„åŒé€šé“æ¸²æŸ“é€»è¾‘ï¼š

1. **è½®å»“é®ç½©é€šé“**: å°†ç›®æ ‡å¯¹è±¡æ¸²æŸ“åˆ°ä¸“ç”¨RTçº¹ç†
2. **è½®å»“ç”Ÿæˆé€šé“**: ä½¿ç”¨Sobelç®—å­ç”Ÿæˆæœ€ç»ˆè½®å»“æ•ˆæœ

### æ¸²æŸ“å±‚çº§ç³»ç»Ÿ

```csharp
_filteringSettings = new FilteringSettings(RenderQueueRange.all, renderingLayerMask: 1 << 8);
```

- ä½¿ç”¨ç¬¬8ä¸ªæ¸²æŸ“å±‚çº§ ("Outline")
- åªæ¸²æŸ“æŒ‡å®šå±‚çº§çš„å¯¹è±¡
- ç²¾ç¡®æ§åˆ¶è½®å»“çº¿æ˜¾ç¤ºèŒƒå›´

## ğŸ¯ ä½¿ç”¨æŒ‡å—

### å¿«é€Ÿå¼€å§‹

1. **æ·»åŠ RendererFeature**
   - åœ¨URP Renderer Assetä¸­æ·»åŠ `OutlineRendererFeature`
   - åˆ†é…è½®å»“çº¿æè´¨çƒ

2. **è®¾ç½®å¯¹è±¡è½®å»“**
   - é€‰æ‹©éœ€è¦è½®å»“çº¿çš„æ¸¸æˆå¯¹è±¡
   - å°†Rendererçš„"Rendering Layer Mask"è®¾ä¸º"Outline"

3. **è°ƒæ•´æ•ˆæœ**
   - `_OutlineColor`: è°ƒæ•´è½®å»“é¢œè‰²(æ”¯æŒHDR)
   - `_OutlineSize`: è°ƒæ•´è½®å»“ç²—ç»†(0-0.005)

### é«˜çº§é…ç½®

#### æè´¨çƒå‚æ•°
```hlsl
[HDR] _OutlineColor ("Outline Color", Color) = (0,1,1,1)
_OutlineSize ("Outline Thickness", Range(0,0.005)) = 0.002
```

#### æ€§èƒ½ä¼˜åŒ–å»ºè®®
- **åˆ†è¾¨ç‡ç¼©æ”¾**: è€ƒè™‘é™ä½è½®å»“RTåˆ†è¾¨ç‡ä»¥æå‡æ€§èƒ½
- **å±‚çº§ç®¡ç†**: åªå¯¹å¿…è¦å¯¹è±¡ä½¿ç”¨è½®å»“å±‚çº§
- **æ‰¹å¤„ç†ä¼˜åŒ–**: å°½é‡å‡å°‘çŠ¶æ€åˆ‡æ¢

## ğŸ“Š ç‰ˆæœ¬å¯¹æ¯”

| ç‰¹æ€§ | Unity 2022.3-2023.x | Unity 6.0+ |
|------|---------------------|-------------|
| æ¸²æŸ“æ¨¡å¼ | Execute | RenderGraph |
| èµ„æºç®¡ç† | æ‰‹åŠ¨ | è‡ªåŠ¨ |
| æ€§èƒ½ | æ ‡å‡† | ä¼˜åŒ– |
| è°ƒè¯•æ”¯æŒ | åŸºç¡€ | å¢å¼º |
| GPUå†…å­˜ | æ‰‹åŠ¨ä¼˜åŒ– | è‡ªåŠ¨ä¼˜åŒ– |

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**è½®å»“çº¿ä¸æ˜¾ç¤º**
```
âœ“ æ£€æŸ¥å¯¹è±¡æ˜¯å¦åœ¨"Outline"æ¸²æŸ“å±‚çº§
âœ“ ç¡®è®¤RendererFeatureå·²å¯ç”¨
âœ“ éªŒè¯æè´¨çƒé…ç½®æ­£ç¡®
âœ“ æ£€æŸ¥Unityç‰ˆæœ¬å…¼å®¹æ€§
```

**ç‰ˆæœ¬å‡çº§é—®é¢˜**
```
âœ“ Unity 6.0+å‡çº§åé‡æ–°ç¼–è¯‘
âœ“ æ£€æŸ¥RenderGraphåŠŸèƒ½æ˜¯å¦æ­£å¸¸
âœ“ ç¡®è®¤URPç‰ˆæœ¬åŒ¹é…
```

**æ€§èƒ½é—®é¢˜**
```
âœ“ ç›‘æ§RTçº¹ç†å†…å­˜ä½¿ç”¨
âœ“ è€ƒè™‘åˆ†è¾¨ç‡ç¼©æ”¾
âœ“ ä¼˜åŒ–è½®å»“å¯¹è±¡æ•°é‡
âœ“ åœ¨Unity 6.0+ä¸­å¯ç”¨RenderGraphä¼˜åŒ–
```

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

### æ”¯æŒçš„Unityç‰ˆæœ¬
- **æœ€ä½ç‰ˆæœ¬**: Unity 2022.3 LTS
- **æ¨èç‰ˆæœ¬**: Unity 2023.3 LTS æˆ– Unity 6.0+
- **URPç‰ˆæœ¬**: 12.0+ (Unity 2022.3+), 17.0+ (Unity 6.0+)

### æ”¯æŒçš„å¹³å°
- Windowsã€macOSã€Linux
- iOSã€Android
- WebGL
- ä¸»æœºå¹³å° (PlayStationã€Xboxã€Switch)

## ğŸ› ï¸ å¼€å‘ä¿¡æ¯

### æŠ€æœ¯æ ˆ
- **æ¸²æŸ“ç®¡çº¿**: Universal Render Pipeline
- **ç€è‰²å™¨è¯­è¨€**: HLSL
- **è¾¹ç¼˜æ£€æµ‹**: Sobelç®—å­
- **å…¼å®¹æ€§**: æ¡ä»¶ç¼–è¯‘æŒ‡ä»¤

### å…³é”®ç±»è¯´æ˜

#### `OutlineRendererFeature`
- ä¸»è¦çš„ScriptableRendererFeatureå®ç°
- ç®¡ç†æ¸²æŸ“é€šé“ç”Ÿå‘½å‘¨æœŸ
- å¤„ç†ç‰ˆæœ¬å…¼å®¹æ€§

#### `OutlineRenderPass`
- å…·ä½“çš„æ¸²æŸ“é€»è¾‘å®ç°
- åŒè·¯å¾„æ¸²æŸ“æ”¯æŒ
- èµ„æºç®¡ç†å’Œæ¸…ç†

### ä»£ç ç»“æ„
```
OutlineRendererFeature.cs
â”œâ”€â”€ ç‰ˆæœ¬æ£€æµ‹ (#if UNITY_6000_0_OR_NEWER)
â”œâ”€â”€ ä¼ ç»Ÿæ¸²æŸ“è·¯å¾„ (Executeæ–¹æ³•)
â”œâ”€â”€ RenderGraphè·¯å¾„ (RecordRenderGraphæ–¹æ³•)
â””â”€â”€ é€šç”¨èµ„æºç®¡ç†
```

## ğŸš€ æœªæ¥è§„åˆ’

### è®¡åˆ’åŠŸèƒ½
- [ ] å¤šé‡è½®å»“çº¿æ”¯æŒ
- [ ] è½®å»“çº¿åŠ¨ç”»æ•ˆæœ
- [ ] è·ç¦»è‡ªé€‚åº”è½®å»“
- [ ] è‡ªå®šä¹‰è½®å»“å½¢çŠ¶
- [ ] å®æ—¶è½®å»“é¢œè‰²è°ƒæ•´

### æ€§èƒ½ä¼˜åŒ–
- [ ] æ›´é«˜æ•ˆçš„è¾¹ç¼˜æ£€æµ‹ç®—æ³•
- [ ] GPU Compute Shaderæ”¯æŒ
- [ ] ç§»åŠ¨ç«¯ç‰¹åŒ–ä¼˜åŒ–
- [ ] Unity 6.0+ RenderGraphæ·±åº¦ä¼˜åŒ–

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ’æŸ¥ï¼š

1. **æ£€æŸ¥Unityç‰ˆæœ¬**: ç¡®è®¤ä½¿ç”¨æ”¯æŒçš„Unityç‰ˆæœ¬
2. **éªŒè¯URPè®¾ç½®**: ç¡®ä¿URPé…ç½®æ­£ç¡®
3. **æŸ¥çœ‹æ§åˆ¶å°**: æ£€æŸ¥æ˜¯å¦æœ‰ç¼–è¯‘é”™è¯¯æˆ–è­¦å‘Š
4. **æ€§èƒ½åˆ†æ**: ä½¿ç”¨Unity Profileråˆ†ææ€§èƒ½
5. **ç‰ˆæœ¬å…¼å®¹**: ç¡®è®¤ä»£ç é€‚é…å½“å‰Unityç‰ˆæœ¬

---

**ğŸ“ æ›´æ–°æ—¥å¿—**
- **v2.0**: æ·»åŠ Unity 6.0+ RenderGraphæ”¯æŒ
- **v1.5**: ä¼˜åŒ–ä¼ ç»Ÿæ¸²æŸ“è·¯å¾„æ€§èƒ½
- **v1.0**: åˆå§‹ç‰ˆæœ¬ï¼Œæ”¯æŒåŸºç¡€è½®å»“çº¿åŠŸèƒ½

*è¯¥ç³»ç»Ÿå·²åœ¨å¤šä¸ªUnityç‰ˆæœ¬ä¸­æµ‹è¯•éªŒè¯ï¼Œç¡®ä¿ç¨³å®šæ€§å’Œå…¼å®¹æ€§ã€‚* 